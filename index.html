<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>업무 포털</title>

<style>
body{
font-family: Arial;
background:#f5f6fa;
margin:0;
}

header{
background:#2f3542;
color:white;
padding:15px;
font-size:20px;
}

.container{
padding:20px;
}

button{
padding:8px 14px;
cursor:pointer;
}

input{
padding:8px;
margin:5px 0;
width:200px;
}

.card{
background:white;
padding:15px;
margin-bottom:10px;
border-radius:8px;
}
</style>
</head>
<body>

<header>
업무포털
</header>

<div class="container">

<div id="loginBox" class="card">

<h3>로그인</h3>

<input id="email" placeholder="이메일"><br>
<input id="password" type="password" placeholder="비밀번호"><br>

<button onclick="login()">로그인</button>
<button onclick="signup()">회원가입</button>

</div>


<div id="adminPanel" class="card" style="display:none">

<h3>관리자 페이지</h3>

<div id="userList"></div>

</div>


<div id="staffPanel" class="card" style="display:none">

<h3>직원 페이지</h3>
승인 대기중입니다.

</div>

</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import {
getAuth,
createUserWithEmailAndPassword,
signInWithEmailAndPassword,
onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
getFirestore,
doc,
setDoc,
getDoc,
collection,
getDocs,
updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {

apiKey: "여기에",
authDomain: "여기에",
projectId: "여기에",
storageBucket: "여기에",
messagingSenderId: "여기에",
appId: "여기에"

};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

window.login = async function(){

const email = document.getElementById("email").value;
const pw = document.getElementById("password").value;

await signInWithEmailAndPassword(auth,email,pw);

};

window.signup = async function(){

const email = document.getElementById("email").value;
const pw = document.getElementById("password").value;

const result = await createUserWithEmailAndPassword(auth,email,pw);

await setDoc(doc(db,"users",result.user.uid),{

email: email,
name: "",
role: "staff",
approved: false,
createdAt: new Date()

});

alert("가입 완료 / 관리자 승인 필요");

};

onAuthStateChanged(auth, async (user)=>{

if(!user) return;

const ref = doc(db,"users",user.uid);
const snap = await getDoc(ref);

const data = snap.data();

if(data.role === "admin"){

document.getElementById("adminPanel").style.display="block";
loadUsers();

}else{

document.getElementById("staffPanel").style.display="block";

}

});


async function loadUsers(){

const querySnapshot = await getDocs(collection(db,"users"));

let html="";

querySnapshot.forEach((docSnap)=>{

const d = docSnap.data();

html += `
<div class="card">
${d.email}
<br>
승인:${d.approved}
<br>
<button onclick="approve('${docSnap.id}')">승인</button>
</div>
`;

});

document.getElementById("userList").innerHTML = html;

}


window.approve = async function(uid){

await updateDoc(doc(db,"users",uid),{

approved:true

});

alert("승인 완료");
loadUsers();

}

</script>

</body>
</html>
